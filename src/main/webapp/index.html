<!DOCTYPE html>
<html>
    <head>
        <title>CICLOPE - SUPER ASSISTENZA</title>
        <!-- Include meta tag to ensure proper rendering and touch zooming -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>

        <!-- Include jQuery Mobile stylesheets -->
        <link rel="stylesheet" href="js/libs/jquery-mobile/jquery.mobile.min.css"/>

        <!-- Include the jQuery library -->
        <script src="js/libs/jquery/jquery.min.js"></script>

        <!-- Include the jQuery Mobile library -->
        <script src="js/libs/jquery-mobile/jquery.mobile.min.js"></script>
        <!-- others scripting stuff -->
        <script type="text/javascript" src="js/jquery.scannerdetection.js"></script>
        <!-- datebox jstage -->
        <link href="js/libs/jquery-mobile-datebox/jqm-datebox.css" rel="stylesheet" type="text/css">
        <script src="js/libs/jquery-mobile-datebox/jqm-datebox.comp.calbox.js" type="text/javascript"></script>
        <script src="js/libs/jquery-mobile-datebox/jqm-datebox.i18n.it.utf8.js" type="text/javascript"></script>
        <script>
            //delarations...
            var praticaName, personaleName, praticaHeaderName, personale_corrente, giornata_corrente,
                    pratica_corrente, praticaJson, materialeJson, orelavorateJson, rifornimentoJson;
            var praticaOreLavorate = null;
            var listaMateriali = null;
            var materialeAggiornato = null;
            var approvvigionamentoAggiornato = null;
            function escapeJS(stringa) {
                return stringa.replace(/(['"])/g, "\\$1");
            }
            function MaterialeMagazzino(codice, description, qty) {
                this._codice = codice;
                this._description = description;
                this._qty = qty;
                this.addQty = function (qty) {
                    this._qty += qty;
                };
                this.removeQty = function (qty) {
                    this._qty -= qty;
                };
            }
            //codes...


            function currentMaterial(idMateriale) {
                var itemMateriale = $("#lista_materiale.div");
            }
            function creaPraticaTemporanea() {
                var p = {
                    "cliente": $("#nome_cliente").val(),
                    "veicolo": $("#dati_veicolo").val(),
                    "kilometri": $("#kilometri_correnti").val(),
                    "lavori": $("#lavori_segnalati").val()
                };
                requestJson = encodeURIComponent(JSON.stringify(p));
                $.mobile.loading('show', {
                    text: 'Creazione in corso, attendere...',
                    textVisible: true,
                    theme: 'b',
                    html: ""
                });
                $.ajax({
                    url: "CreaPraticaTemporanea",
                    cache: false,
                    data: requestJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        if (data.result === "ok") {
                            $.mobile.loading('show', {
                                text: 'Fatto!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                                $.mobile.navigate("#pgMagazzino");
                            }, 1000);
                        } else {
                            $.mobile.loading('show', {
                                text: data.message,
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                                $.mobile.navigate("#pgMagazzino");
                            }, 1000);
                        }
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 1000);
                    }
                });
            }
            function AddPraticaLavorataOdierna(pratica, nome_pratica) {
                var p = {"praticaId": pratica, "giornata": giornata_corrente, "personale": personale_corrente};
                requestJson = JSON.stringify(p);
                $.mobile.loading('show', {
                    text: 'Aggiornamento in corso, attendere...',
                    textVisible: true,
                    theme: 'b',
                    html: ""
                });
                $.ajax({
                    url: "AddPraticaLavorataOdierna",
                    cache: false,
                    data: requestJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        if (data.result === "ok") {
                            $.mobile.loading('show', {
                                text: 'Fatto!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            $.mobile.loading("hide");
                        } else {
                            $.mobile.loading('show', {
                                text: data.message,
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 1000);
                        }
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 1000);
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                        AggiornaOreLavorate($("#giornata").datebox('getTheDate'));
                    }
                });
            }
            function GetPraticheOreLavorateDlg() {
                var request = {"personaleId": personale_corrente, "data": giornata_corrente};
                requestJson = JSON.stringify(request);
                $.mobile.loading('show', {
                    text: 'Aggiornamento in corso, attendere...',
                    textVisible: true,
                    theme: 'b',
                    html: ""
                });
                $.ajax({
                    url: "GetPraticheOdierneLavorabili",
                    cache: false,
                    data: requestJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Fatto!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        var items2 = [];
                        var items = [];
                        if (data.length === 0) {
                            items.push('<li>Stai gia seguendo tutte le pratiche possibili odierne...</li>');
                        } else {
                            for (var i = 0; i < data.length; i++) {
                                if (data[i].veicolo_temporaneo === '' && data[i].cliente_temporaneo === '') {
                                    items2.push('<li> <a data-rel="back" id="' + data[i].praticaId + '" onClick="AddPraticaLavorataOdierna(this.id,\'' + data[i].marca + ' - ' + data[i].modello + '\')">'
                                            + data[i].marca + ' - ' + data[i].modello + '</a></li>');
                                } else {
                                    items2.push('<li> <a data-rel="back" id="' + data[i].praticaId + '" onClick="AddPraticaLavorataOdierna(this.id,\'' + data[i].marca + ' - ' + data[i].modello + '\')">'
                                            + data[i].cliente_temporaneo + ' - ' + data[i].veicolo_temporaneo + '</a></li>');
                                }
                            }
                            items = items.concat(items2);
                            items.sort(function (a, b) {
                                var valA = $(a).text(),
                                        valB = $(b).text();
                                if (valA < valB) {
                                    return -1;
                                }
                                if (valA > valB) {
                                    return 1;
                                }
                                return 0;
                            });
                        }
                        $("#lstPraticheLavorate").empty();
                        $("#lstPraticheLavorate").html(items);
                        $("#lstPraticheLavorate").listview("refresh");
                        $.mobile.loading("hide");
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 1000);
                    }
                });
            }
            function updatePraticaId(id, header) {
                var pratica = {"praticaId": id.toString(), "praticaHeader": encodeURIComponent(header)};
                praticaName = $("#".concat(id)).text();
                praticaHeaderName = header;
                praticaJson = JSON.stringify(pratica);
                pratica_corrente = id.toString();
            }
            function updateRifornimentoName(idMateriale, qty) {
                materialeAggiornato = $("#" + idMateriale).text();
                var pos = materialeAggiornato.lastIndexOf(" ");
                var dlgTitolo = materialeAggiornato.slice(0, pos);
                $("#titleRifornimenti").text(dlgTitolo);
                $('input[name="codiceMaterialeRif"]').val(idMateriale.toString());
                $('input[name="rifornimento_corrente"]').val(qty.toString());
                $('input[name="quantita_da_rifornire"]').val("0".toString());
                $("#title_rifornimento_corrente").text("Rifornimento attuale:  " + qty.toString());
            }
            function updateApprovvigionamentoName(idMateriale, qty) {
                materialeAggiornato = $("#" + idMateriale).text();
                var pos = materialeAggiornato.lastIndexOf(" ");
                var dlgTitolo = materialeAggiornato.slice(0, pos);
                $("#titleApprovvigionamenti").text(dlgTitolo);
                $('input[name="codiceMateriale"]').val(idMateriale.toString());
                $('input[name="approvvigionamento_corrente"]').val(qty.toString());
                $('input[name="quantita_da_approvvigionare"]').val("0".toString());
                $("#title_approvvigionamento_corrente").text("Approvvigionamento attuale:  " + qty.toString());
            }
            function updateMaterialName(idMateriale, qty) {
                approvvigionamentoAggiornato = $("#" + idMateriale).text();
                var pos = approvvigionamentoAggiornato.lastIndexOf(" ");
                var dlgTitolo = approvvigionamentoAggiornato.slice(0, pos);
                $("#titleAggiornamento").text(dlgTitolo);
                $('input[name="praticaId"]').val(pratica_corrente);
                $('input[name="materialeId"]').val(idMateriale.toString());
                $('input[name="quantita_corrente"]').val(qty.toString());
                $('input[name="quantita_da_aggiornare"]').val("0".toString());
                $("#title_qty_corrente").text("Quantita attualmente utilizzata: " + qty.toString());
            }
            function updatePraticaOreLavorate(idPraticaOrelavorate, ore) {
                praticaOreLavorate = idPraticaOrelavorate;
                $("#ore_da_aggiornare").val(ore);
            }
            function updatePersonaleName(idPersonale) {
                personale_corrente = idPersonale;
                personaleName = $("#" + idPersonale).text();
            }
            function cleanUpdateLoader(qty) {
                $.mobile.loading("hide");
                $("#title_qty_corrente").text("Quantita attualmente utilizzata: " + qty.toString());
                $('input[name="quantita_corrente"]').val(qty);
            }
            function cleanUpdateApprovvigionamentoLoader(data) {
                $.mobile.loading("hide");
                $("#title_approvvigionamento_corrente").text("Approvvigionamento attuale: " + data.qty);
                $('input[name="approvvigionamento_corrente"]').val(data.qty);
            }
            function cleanUpdateRifornimentoLoader(data) {
                $.mobile.loading("hide");
                $("#title_rifornimento_corrente").text("Rifornimento attuale: " + data.qty);
                $('input[name="rifornimento_corrente"]').val(data.qty);
            }
            function AggiornaApprovvigionamentoDlg() {
                var _p1 = $('input[name="codiceMateriale"]').val();
                var _p2 = $('input[name="quantita_da_approvvigionare"]').val();
                var _p3 = $('input[name="approvvigionamento_corrente"]').val();
                var approvvigionamento = {"materialeId": _p1, "quantita_da_approvvigionare": _p2, "quantita_corrente": _p3};
                approvvigionamentoJson = JSON.stringify(approvvigionamento);
                $.mobile.loading('show', {
                    text: 'Aggiornamento in corso, attendere...',
                    textVisible: true,
                    theme: 'b',
                    html: ""
                });
                $.ajax({
                    url: "UpdateQuantitaApprovvigionamento",
                    cache: false,
                    data: approvvigionamentoJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        if (data.result === "ok") {
                            $.mobile.loading('show', {
                                text: 'Fatto!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(cleanUpdateApprovvigionamentoLoader, 1000, data);
                        } else {
                            $.mobile.loading('show', {
                                text: data.message,
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 1000);
                        }
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 1000);
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                    }
                });
            }
            function AggiornaRifornimentoDlg() {
                var _p1 = $('input[name="codiceMaterialeRif"]').val();
                var _p2 = $('input[name="quantita_da_rifornire"]').val();
                var _p3 = $('input[name="rifornimento_corrente"]').val();
                var rifornimento = {"materialeId": _p1, "quantita_da_rifornire": _p2, "quantita_corrente": _p3};
                rifornimentoJson = JSON.stringify(rifornimento);
                $.mobile.loading('show', {
                    text: 'Aggiornamento in corso, attendere...',
                    textVisible: true,
                    theme: 'b',
                    html: ""
                });
                $.ajax({
                    url: "UpdateQuantitaRifornimento",
                    cache: false,
                    data: rifornimentoJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        if (data.result === "ok") {
                            $.mobile.loading('show', {
                                text: 'Fatto!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(cleanUpdateRifornimentoLoader, 1000, data);
                        } else {
                            $.mobile.loading('show', {
                                text: data.message,
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 1000);
                        }
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 1000);
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                    }
                });
            }
            function AggiornaQuantitaMaterialeDlg() {
                var _p1 = $('input[name="praticaId"]').val();
                var _p2 = $('input[name="materialeId"]').val();
                var _p3 = $('input[name="quantita_da_aggiornare"]').val();
                var _p4 = $('input[name="quantita_corrente"]').val();
                var p = {"praticaId": _p1, "materialeId": _p2, "quantita_da_aggiornare": _p3, "quantita_corrente": _p4};
                materialeJson = JSON.stringify(p);
                $.mobile.loading('show', {
                    text: 'Aggiornamento in corso, attendere...',
                    textVisible: true,
                    theme: 'b',
                    html: ""
                });
                $.ajax({
                    url: "UpdateQuantitaMateriale",
                    cache: false,
                    data: materialeJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        if (data.result === "ok") {
                            $.mobile.loading('show', {
                                text: 'Fatto!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(cleanUpdateLoader, 1000, data.qty);
                        } else {
                            $.mobile.loading('show', {
                                text: data.message,
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 1000);
                        }
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 1000);
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                    }
                });
            }
            function AggiornaQuantitaMateriale(mId, qtyCur) {
                var _p1 = pratica_corrente;
                var _p2 = mId;
                var _p3 = '1';
                var _p4 = qtyCur;
                var p = {"praticaId": _p1, "materialeId": _p2, "quantita_da_aggiornare": _p3, "quantita_corrente": _p4};
                materialeJson = JSON.stringify(p);
                $.mobile.loading('show', {
                    text: 'Aggiornamento in corso, attendere...',
                    textVisible: true,
                    theme: 'b',
                    html: ""
                });
                $.ajax({
                    url: "UpdateQuantitaMateriale",
                    cache: false,
                    data: materialeJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        if (data.result === "ok") {
                            $.mobile.loading('show', {
                                text: 'Fatto!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 250);
                        } else {
                            $.mobile.loading('show', {
                                text: 'Errore: aggiornamento non eseguito!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 250);
                        }
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 250);
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                    }
                });
            }
            function CancellaOreLavoratePratica(idOreLavorate) {
                var ol = null;
                if (idOreLavorate !== undefined)
                    ol = {"ore": idOreLavorate.toString()};
                else
                    ol = {"ore": praticaOreLavorate.toString()};
                var oreJson = JSON.stringify(ol);
                $.mobile.loading('show', {
                    text: 'Caricamento dati, attendere...',
                    textVisible: true,
                    theme: 'z',
                    html: ""
                });
                $.ajax({
                    url: "DeleteOreLavorate",
                    cache: false,
                    data: oreJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        console.log("success");
                    },
                    error: function (xhttpjqr, err, data) {
                        console.log("error");
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                        $.mobile.loading("hide");
                        AggiornaOreLavorate($("#giornata").datebox('getTheDate'));
                    }
                });

            }
            function AggiornaOreLavoratePratica() {
                var orelavorate = {"idOreLavorate": praticaOreLavorate, "ore": $("#ore_da_aggiornare").val()};
                orelavorateJson = JSON.stringify(orelavorate);
                $.mobile.loading('show', {
                    text: 'Aggiornamento dati, attendere...',
                    textVisible: true,
                    theme: 'z',
                    html: ""
                });
                $.ajax({
                    url: "AggiornaOreLavorate",
                    cache: false,
                    data: orelavorateJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        $.mobile.loading("hide");
                        if (data.result === "ok") {
                            $.mobile.loading('show', {
                                text: 'Fatto!',
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 1000);
                        } else {
                            $.mobile.loading('show', {
                                text: data.message,
                                textVisible: true,
                                theme: 'b',
                                html: ""
                            });
                            setTimeout(function () {
                                $.mobile.loading("hide");
                            }, 1000);
                        }
                    },
                    error: function (xhttpjqr, err, data) {
                        $.mobile.loading("hide");
                        $.mobile.loading('show', {
                            text: 'Errore di comunicazione!',
                            textVisible: true,
                            theme: 'b',
                            html: ""
                        });
                        setTimeout(function () {
                            $.mobile.loading("hide");
                        }, 1000);
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                        AggiornaOreLavorate($("#giornata").datebox('getTheDate'));
                    }
                });

            }
            function AggiornaOreLavorate(date) {
                giornata_corrente = date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
                var orelavorate = {"personaleId": personale_corrente, "giornata": giornata_corrente};
                orelavorateJson = JSON.stringify(orelavorate);
                $.mobile.loading('show', {
                    text: 'Caricamento dati, attendere...',
                    textVisible: true,
                    theme: 'z',
                    html: ""
                });
                $.ajax({
                    url: "GetOreLavorate",
                    cache: false,
                    data: orelavorateJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        var items2 = [];
                        var items = [];
                        if (data.length === 0) {
                            items.push('<li>Nessuna pratica presente...</li>');
                            $("#ore_totali").html('<h2>TOTALE ORE: <span style="font-weight: bold">0</span></h2>');
                        } else {
                            var isTemp = false; 
                            for (var i = 0; i < data.length; i++) {
                                isTemp = (data[i].cliente_temporaneo !== '' && data[i].veicolo_temporaneo !== '');
                                items2.push('<li><a href="#popupAggiornaOreLavoratePratica" id="' + data[i].IdOreLavorate + '" data-rel="popup"\n\
                data-position-to="window" data-transition="slidefade" onClick="updatePraticaOreLavorate(this.id,' + data[i].ore + ')">'
                                        + (isTemp?data[i].cliente_temporaneo:data[i].marca) + " " + (isTemp?data[i].veicolo_temporaneo:data[i].modello) + '<div class="ui-li-count">' + data[i].ore + ' ore</div></a>\n\
                <a href="#popupEliminaPraticaOreLavorate" data-rel="popup" data-position-to="window" data-transition="pop" \n\
onClick="updatePraticaOreLavorate(' + data[i].IdOreLavorate + ',' + data[i].ore + ')">Elimina</a></li>');
                            }
                            items = items.concat(items2);
                            items.sort(function (a, b) {
                                var valA = $(a).text(),
                                        valB = $(b).text();
                                if (valA < valB) {
                                    return -1;
                                }
                                if (valA > valB) {
                                    return 1;
                                }
                                return 0;
                            });
                            $("#ore_totali").html('<h2>TOTALE ORE: <span style="font-weight: bold">' + data[0].oreTotali + '</span></h2>');
                        }
                        $("#lstUltimePratiche").empty();
                        $("#lstUltimePratiche").html(items);
                        $("#lstUltimePratiche").listview("refresh");

                        $.mobile.loading("hide");
                    },
                    error: function (xhttpjqr, err, data) {
                        $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                        $.mobile.loading("hide");
                    }
                });
            }
            function addMaterialePratica(mId) {
                $("#lista_materiale").empty();
                $.mobile.loading('show', {
                    text: 'Caricamento dati, attendere...',
                    textVisible: true,
                    theme: 'z',
                    html: ""
                });
                var _p1 = pratica_corrente;
                var _p2 = mId;
                var _p3 = '1';
                var p = {"praticaId": _p1, "materialeId": _p2, "quantita_da_aggiornare": _p3, praticaHeader: praticaHeaderName};
                materialeJson = JSON.stringify(p);
                $.ajax({
                    url: "AddMaterialeInRiparazione",
                    cache: false,
                    data: materialeJson,
                    dataType: 'json',
                    type: 'POST',
                    async: true,
                    success: function (data) {
                        var items2 = [];
                        var items = [];
                        if (data.length > 0) {
                            $("#nome_riparazione").empty();
                            $("#nome_riparazione").html("<h1>" + data[0].praticaHeader + "</h1>");
                        }
                        for (var i = 0; i < data.length; i++) {
                            items2.push('<li><a href="#dlgAggiornaQuantita" \n\
                onClick="updateMaterialName(this.id,' + data[i].quantita_consumata + ')" id="' + data[i].codice + '">'
                                    + data[i].descrizione + ' <div class="ui-li-count count_prev">' + data[i].quantita_consumata + '</div></a></li>');
                        }

                        items = items.concat(items2);
                        items.sort(function (a, b) {
                            var valA = $(a).text(),
                                    valB = $(b).text();
                            if (valA < valB) {
                                return -1;
                            }
                            if (valA > valB) {
                                return 1;
                            }
                            return 0;
                        });
                        $("#lista_materiale").empty();
                        $("#lista_materiale").html(items);
                        $("#lista_materiale").listview("refresh");
                        $.mobile.loading("hide");
                    },
                    error: function (xhttpjqr, err, data) {
                        $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                    },
                    complete: function (xhttpjqr, evtobj, data) {
                        $.mobile.loading("hide");
                    }
                });
            }
            function reload() {
                location.reload(true);
            }
            //events...
            $(document).on("popupafteropen", "#popupAggiungiPraticaOreLavorate", function (event, ui) {
                GetPraticheOreLavorateDlg();
            });
            $(document).on("mobileinit", function () {
                $.mobile.loader.prototype.options.text = "Caricamento dati, attendere...";
                $.mobile.loader.prototype.options.textVisible = true;
                $.mobile.loader.prototype.options.theme = "a";
                $.mobile.loader.prototype.options.html = "";
            });
            $(document).on("pagecontainercreate", function (event, ui) {
                if (event.target.firstElementChild.id === 'pgMagazzino') {
                    if (listaMateriali === null) {
                        //load all material list...
                        $.mobile.loading('show', {
                            text: 'Caricamento lista materiali di magazzino, attendere...',
                            textVisible: true,
                            theme: 'z',
                            html: ""
                        });
                        $.ajax({
                            url: "GetMaterialiMagazzino",
                            cache: false,
                            dataType: 'json',
                            type: 'POST',
                            async: true,
                            success: function (data) {
                                listaMateriali = [];
                                if (data.length !== 0) {
                                    for (var i = 0; i < data.length; i++) {
                                        listaMateriali.push(new MaterialeMagazzino(data[i].codice, 0, data[i].rimanenza));
                                    }
                                }
                                $.mobile.loading("hide");
                            },
                            error: function (xhttpjqr, err, data) {
                                $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                            },
                            complete: function (xhttpjqr, evtobj, data) {
                                $.mobile.loading("hide");
                            }
                        });
                    }
                }
            });
            // Initialize/deinitialize BARCODE SCANNING
            $(document).on('pagecontainerhide', function (event, ui) {
                if (ui.prevPage[0].id === 'pgRifornimenti') {
                    console.log("Hide pgRifornimenti");
                    $("#lista_rifornimenti").empty();
                    $(document).scannerDetection(false);
                }
                if (ui.prevPage[0].id === 'pgApprovvigionamenti') {
                    console.log("Hide pgApprovvigionamenti");
                    $("#lista_approvvigionamenti").empty();
                    $(document).scannerDetection(false);
                }
                if (ui.prevPage[0].id === 'pgMaterialeUtilizzato') {
                    console.log("Hide pgMaterialeUtilizzato");
                    $("#lista_materiale").empty();
                    $(document).scannerDetection(false);
                }
            });
            $(document).on("pagecontainershow", function (event, ui)
            {
                if (ui.toPage[0].id === 'pgSelezioneEntrate')
                {
                    $("#lstRiparazioni").empty();
                    $.mobile.loading('show', {
                        text: 'Caricamento dati, attendere...',
                        textVisible: true,
                        theme: 'z',
                        html: ""
                    });
                    $.ajax({
                        url: "GetRiparazioniCorrenti",
                        cache: false,
                        dataType: 'json',
                        async: true,
                        success: function (data) {
                            var items2 = [];
                            var items = [];
                            if (data.length === 0) {
                                items.push('<li>Nessun materiale utilizzato al momento...</li>');
                            } else {
                                for (var i = 0; i < data.length; i++) {
                                    if ((data[i].cliente_temporaneo.trim().toString() === '') &&
                                            (data[i].veicolo_temporaneo.trim().toString() === '')) {
                                        items2.push('<li><a href="#pgMaterialeUtilizzato" id="' + data[i].praticaId + '" onClick="updatePraticaId(this.id,\'' + escapeJS(data[i].marca) + ' - ' + escapeJS(data[i].modello) + '\')">'
                                                + 'MARCHIO:<span style="font-weight: normal;">&nbsp;&nbsp;' + data[i].marca + "</span>" +
                                                ' - MODELLO:<span style="font-weight: normal;">&nbsp;&nbsp;' + data[i].modello + "</span>" +
                                                ' - TARGA:<span style="font-weight: normal;">&nbsp;&nbsp;' + data[i].targa + "</span>" +
                                                ' - MATRICOLA:<span style="font-weight: normal;">&nbsp;&nbsp;' + data[i].matricola + "</span>" +
                                                '</a></li>'
                                                );
                                    } else {
                                        //sanitizzare le stringhe cliente_temporaneo e veicolo_temporaneo...

                                        items2.push('<li><a href="#pgMaterialeUtilizzato" id="' + data[i].praticaId + '" onClick="updatePraticaId(this.id,\'' + escapeJS(data[i].cliente_temporaneo) + ' - ' + escapeJS(data[i].veicolo_temporaneo) + '\')">'
                                                + 'RIPARAZIONE:<span style="font-weight: normal;">&nbsp;&nbsp;' + data[i].veicolo_temporaneo + "</span>" +
                                                ' - CLIENTE:<span style="font-weight: normal;">&nbsp;&nbsp;' + data[i].cliente_temporaneo + "</span>" +
                                                '</a></li>'
                                                );
                                    }
                                }

                                items = items.concat(items2);
                                items.sort(function (a, b) {
                                    var valA = $(a).text(),
                                            valB = $(b).text();
                                    if (valA < valB) {
                                        return -1;
                                    }
                                    if (valA > valB) {
                                        return 1;
                                    }
                                    return 0;
                                });
                            }
                            $("#lstRiparazioni").empty();
                            $("#lstRiparazioni").html(items);
                            $("#lstRiparazioni").listview("refresh");
                            $.mobile.loading("hide");
                        },
                        error: function (xhttpjqr, err, data) {
                            $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                        },
                        complete: function (xhttpjqr, evtobj, data) {
                            $.mobile.loading("hide");
                        }
                    });
                } else if (ui.toPage[0].id === 'pgOreLavorate-main') {
                    $("#lstOperatori").empty();
                    $.mobile.loading('show', {
                        text: 'Caricamento dati, attendere...',
                        textVisible: true,
                        theme: 'z',
                        html: ""
                    });
                    $.ajax({
                        url: "GetOperatori",
                        cache: false,
                        dataType: 'json',
                        async: true,
                        success: function (data) {
                            var items2 = [];
                            var items = [];
                            if (data.length === 0) {
                                items.push('<li>Nessuna pratica presente...</li>');
                            } else {
                                for (var i = 0; i < data.length; i++) {
                                    items2.push('<li><a href="#pgOreLavorate-selezione" id="' + data[i].operatoreId + '" onClick="updatePersonaleName(this.id)">'
                                            + data[i].nome_cognome + '</a></li>');
                                }

                                items = items.concat(items2);
                                items.sort(function (a, b) {
                                    var valA = $(a).text(),
                                            valB = $(b).text();
                                    if (valA < valB) {
                                        return -1;
                                    }
                                    if (valA > valB) {
                                        return 1;
                                    }
                                    return 0;
                                });
                            }
                            $("#lstOperatori").empty();
                            $("#lstOperatori").html(items);
                            $("#lstOperatori").listview("refresh");
                            $.mobile.loading("hide");
                        },
                        error: function (xhttpjqr, err, data) {
                            $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                        },
                        complete: function (xhttpjqr, evtobj, data) {
                            $.mobile.loading("hide");
                        }
                    });
                } else if (ui.toPage[0].id === 'pgOreLavorate-selezione') {

                    var today = new Date();
                    var dd = today.getDate();
                    var mm = today.getMonth() + 1; //January is 0!

                    var yyyy = today.getFullYear();
                    if (dd < 10) {
                        dd = '0' + dd;
                    }
                    if (mm < 10) {
                        mm = '0' + mm;
                    }
                    giornata_corrente = dd + '/' + mm + '/' + yyyy;
                    var dp = $('input[name="giornata"]');
                    dp.val(giornata_corrente);
                    $("#lstUltimePratiche").empty();
                    var orelavorate = {"personaleId": personale_corrente, "giornata": giornata_corrente};
                    orelavorateJson = JSON.stringify(orelavorate);
                    $.mobile.loading('show', {
                        text: 'Caricamento dati, attendere...',
                        textVisible: true,
                        theme: 'z',
                        html: ""
                    });
                    $.ajax({
                        url: "GetOreLavorate",
                        cache: false,
                        data: orelavorateJson,
                        dataType: 'json',
                        type: 'POST',
                        async: true,
                        success: function (data) {
                            var items2 = [];
                            var items = [];
                            if (data.length === 0) {
                                items.push('<li>Nessuna pratica presente...</li>');
                                $("#ore_totali").html('<h2>TOTALE ORE: <span style="font-weight: bold">0</span></h2>');
                            } else {
                                var isTemp = false;
                                for (var i = 0; i < data.length; i++) {
                                    isTemp = (data[i].cliente_temporaneo !== '' && data[i].veicolo_temporaneo !== '');
                                    items2.push('<li><a href="#popupAggiornaOreLavoratePratica" id="' + data[i].IdOreLavorate + '" data-rel="popup"\n\
                data-position-to="window" data-transition="pop" onClick="updatePraticaOreLavorate(this.id,' + data[i].ore + ')">'
                                             + (isTemp?data[i].cliente_temporaneo:data[i].marca) + " " + (isTemp?data[i].veicolo_temporaneo:data[i].modello) + '<div class="ui-li-count">' + data[i].ore + ' ore</div></a>\n\
                <a href="#popupEliminaPraticaOreLavorate" data-rel="popup" data-position-to="window" data-transition="pop" \n\
onClick="updatePraticaOreLavorate(' + data[i].IdOreLavorate + ',' + data[i].ore + ')">Elimina</a></li>');
                                }
                                items = items.concat(items2);
                                items.sort(function (a, b) {
                                    var valA = $(a).text(),
                                            valB = $(b).text();
                                    if (valA < valB) {
                                        return -1;
                                    }
                                    if (valA > valB) {
                                        return 1;
                                    }
                                    return 0;
                                });
                                $("#ore_totali").html('<h2>TOTALE ORE: <span style="font-weight: bold">' + data[0].oreTotali + '</span></h2>');
                            }
                            $("#lstUltimePratiche").empty();
                            $("#lstUltimePratiche").html(items);
                            $("#lstUltimePratiche").listview("refresh");
                            $.mobile.loading("hide");
                        },
                        error: function (xhttpjqr, err, data) {
                            $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                        },
                        complete: function (xhttpjqr, evtobj, data) {
                            $.mobile.loading("hide");
                        }
                    });
                } else if (ui.toPage[0].id === 'pgMaterialeUtilizzato') {
                    //Initialize BARCODE
                    $(document).scannerDetection({
                        timeBeforeScanTest: 200, // wait for the next character for upto 200ms
                        startChar: [], // Prefix character for the cabled scanner (OPL6845R)
                        endChar: [13], // be sure the scan is complete if key 13 (enter) is detected
                        avgTimeByChar: 40, // it's not a barcode if a character takes longer than 40ms
                        minLength: 4,
                        onComplete: function (barcoderaw, qty) {
                            var barcode = barcoderaw.replace(".", "");
                            console.log('Barcode: ' + barcode);
                            var element = $("#" + barcode);
                            if (this.getElementById(barcode) === null) {
                                console.log('NUOVO ' + barcode);
                                addMaterialePratica(barcode);
                            } else {
                                console.log('INCREMENTA ' + barcode);
                                var count = parseInt($("#" + barcode + " .ui-li-count").text());
                                $("#" + barcode + " .ui-li-count").text(count + 1);
                                AggiornaQuantitaMateriale(barcode.toString(), count.toString());
                            }
                        },
                        onError: function (string) {
                            console.log('Errore: ' + string);
                        }
                    });
                    $("#lista_materiale").empty();
                    $.mobile.loading('show', {
                        text: 'Caricamento dati, attendere...',
                        textVisible: true,
                        theme: 'z',
                        html: ""
                    });
                    $.ajax({
                        url: "GetMaterialiRiparazione",
                        cache: false,
                        contentType: 'application/json;charset=UTF-8',
                        data: praticaJson,
                        dataType: 'json',
                        type: 'POST',
                        async: true,
                        success: function (data) {
                            var items2 = [];
                            var items = [];
                            if (data.length > 0) {
                                $("#nome_riparazione").empty();
                                $("#nome_riparazione").html("<h1>" + data[0].praticaHeader + "</h1>");
                                for (var i = 0; i < data.length; i++) {
                                    items2.push('<li><a href="#dlgAggiornaQuantita" \n\
                     onClick="updateMaterialName(this.id,' + parseFloat(data[i].quantita_consumata) + ')" id="' + data[i].codice + '">'
                                            + data[i].descrizione + ' <div class="ui-li-count count_prev">' + parseFloat(data[i].quantita_consumata) + '</div></a></li>');
                                }
                            } else {
                                $("#nome_riparazione").html("<h1>" + praticaHeaderName + "</h1>");
                                $("#lista_materiale").html("<li>Nessuna materiale utilizzato per la riparazione</li>");
                                return;
                            }


                            items = items.concat(items2);
                            items.sort(function (a, b) {
                                var valA = $(a).text(),
                                        valB = $(b).text();
                                if (valA < valB) {
                                    return -1;
                                }
                                if (valA > valB) {
                                    return 1;
                                }
                                return 0;
                            });
                            $("#lista_materiale").empty();
                            $("#lista_materiale").html(items);
                            $("#lista_materiale").listview("refresh");
                            $.mobile.loading("hide");
                        },
                        error: function (xhttpjqr, err, data) {
                            $(":mobile-pagecontainer").pagecontainer("change", "#pgMagazzino");
                        },
                        complete: function (xhttpjqr, evtobj, data) {
                            $.mobile.loading("hide");
                        }
                    });
                } else if (ui.toPage[0].id === 'pgApprovvigionamenti') {
                    //Initialize BARCODE
                    $(document).scannerDetection({
                        timeBeforeScanTest: 200, // wait for the next character for upto 200ms
                        startChar: [], // Prefix character for the cabled scanner (OPL6845R)
                        endChar: [13], // be sure the scan is complete if key 13 (enter) is detected
                        avgTimeByChar: 40, // it's not a barcode if a character takes longer than 40ms
                        minLength: 4,
                        onComplete: function (barcoderaw, qty) {
                            var barcode = barcoderaw.replace(".", "");
                            console.log('Barcode: ' + barcode);
                            var element = $("#" + barcode);
                            if (this.getElementById(barcode) === null) {
                                console.log('NUOVO ' + barcode);
                                addMaterialePratica(barcode);
                            } else {

                            }
                            if (this.getElementById(barcode) === null) {
                                $.mobile.loading('show', {
                                    text: 'Nessun materiale con questo codice trovato...',
                                    textVisible: true,
                                    theme: 'z',
                                    html: ""
                                });
                                setTimeout(function () {
                                    $.mobile.loading("hide");
                                }, 1500);
                            } else {
                                console.log('INCREMENTA ' + barcode);
                                var desc = $("#" + barcode).text().toString();
                                var filterCode = desc.split("-")[0];
                                $("#filterApprovvigionamenti").val(filterCode);
                                $("#lista_approvvigionamenti").listview("refresh");
                            }
                        },
                        onError: function (string) {
                            console.log('Errore: ' + string);
                        }
                    });
                    $("#lista_approvvigionamenti").empty();
                    $.mobile.loading('show', {
                        text: 'Caricamento dati, attendere...',
                        textVisible: true,
                        theme: 'z',
                        html: ""
                    });
                    $.ajax({
                        url: "GetApprovvigionamenti",
                        cache: false,
                        dataType: 'json',
                        type: 'POST',
                        async: true,
                        success: function (data) {
                            var items2 = [];
                            var items = [];
                            for (var i = 0; i < data.length; i++) {
                                items2.push('<li><a href="#dlgAggiornaApprovvigionamento" \n\
                     onClick="updateApprovvigionamentoName(this.id,' + data[i].approvvigionamento + ')" id="' + data[i].codice + '">'
                                        + data[i].descrizione + '<span style="color:' + data[i].color + ';font-size:1em; font-weight:normal"> - RIMANENZA (pz/mt):' + data[i].rimanenza + '</span>' + ' <div class="ui-li-count count_prev">' + data[i].approvvigionamento + '</div>' + '</a></li>');
                            }

                            items = items.concat(items2);
                            items.sort(function (a, b) {
                                var valA = $(a).text(),
                                        valB = $(b).text();
                                if (valA < valB) {
                                    return -1;
                                }
                                if (valA > valB) {
                                    return 1;
                                }
                                return 0;
                            });
                            $("#lista_approvvigionamenti").empty();
                            $("#lista_approvvigionamenti").html(items);
                            $("#lista_approvvigionamenti").listview("refresh");
                            $.mobile.loading("hide");
                        },
                        error: function (xhttpjqr, err, data) {
                            $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                        },
                        complete: function (xhttpjqr, evtobj, data) {
                            $.mobile.loading("hide");
                        }
                    });
                } else if (ui.toPage[0].id === 'pgRifornimenti') {
                    //Initialize BARCODE
                    $(document).scannerDetection({
                        timeBeforeScanTest: 200, // wait for the next character for upto 200ms
                        startChar: [], // Prefix character for the cabled scanner (OPL6845R)
                        endChar: [13], // be sure the scan is complete if key 13 (enter) is detected
                        avgTimeByChar: 40, // it's not a barcode if a character takes longer than 40ms
                        minLength: 4,
                        onComplete: function (barcoderaw, qty) {
                            var barcode = barcoderaw.replace(".", "");
                            console.log('Barcode: ' + barcode);
                            var element = $("#" + barcode);
                            if (this.getElementById(barcode) === null) {
                                $.mobile.loading('show', {
                                    text: 'Nessun materiale con questo codice trovato...',
                                    textVisible: true,
                                    theme: 'z',
                                    html: ""
                                });
                                setTimeout(function () {
                                    $.mobile.loading("hide");
                                }, 1500);
                            } else {
                                var desc = $("#" + barcode).text().toString();
                                var filterCode = desc.split("-")[0];
                                $("#filterRifornimenti").val(filterCode);
                                $("#lista_rifornimenti").listview("refresh");
                            }
                        },
                        onError: function (string) {
                            console.log('Errore: ' + string);
                        }
                    });
                    $("#lista_rifornimenti").empty();
                    $.mobile.loading('show', {
                        text: 'Caricamento dati, attendere...',
                        textVisible: true,
                        theme: 'z',
                        html: ""
                    });
                    $.ajax({
                        url: "GetRifornimenti",
                        cache: false,
                        dataType: 'json',
                        type: 'POST',
                        async: true,
                        success: function (data) {
                            var items2 = [];
                            var items = [];
                            for (var i = 0; i < data.length; i++) {
                                items2.push('<li><a href="#dlgAggiornaRifornimento" \n\
                     onClick="updateRifornimentoName(this.id,' + data[i].rimanenza + ')" id="' + data[i].codice + '">'
                                        + data[i].descrizione + '<span style="color:' + data[i].color + ';font-size:1em; font-weight:normal"> - APPROVVIGIONAMENTO (pz/mt):' + data[i].approvvigionamento + '</span>' + ' <div class="ui-li-count count_prev">' + data[i].rimanenza + '</div>' + '</a></li>');
                            }

                            items = items.concat(items2);
                            items.sort(function (a, b) {
                                var valA = $(a).text(),
                                        valB = $(b).text();
                                if (valA < valB) {
                                    return -1;
                                }
                                if (valA > valB) {
                                    return 1;
                                }
                                return 0;
                            });
                            $("#lista_rifornimenti").empty();
                            $("#lista_rifornimenti").html(items);
                            $("#lista_rifornimenti").listview("refresh");
                            $.mobile.loading("hide");
                        },
                        error: function (xhttpjqr, err, data) {
                            $(":mobile-pagecontainer").pagecontainer("change", "pgMagazzino");
                        },
                        complete: function (xhttpjqr, evtobj, data) {
                            $.mobile.loading("hide");
                        }
                    });
                }
            });
            $('.ui-btn').css('font-size', '30px !important');
        </script>
        <style>
            .seleziona-ore{
                padding-right:20px !important;
            }
        </style>
    </head>

    <body>
        <div data-role="page" id="pgMagazzino" data-title="Gestione Magazzino">
            <div data-role="header" id="header" data-position="fixed">
                <h1>Ciclope - Magazzino</h1>
            </div>
            <div data-role="content">
                <div id="main_content">
                    <div class="ui-grid-solo">
                        <a data-role="button" href="#pgCreazionePratica">Crea Pratica temporanea</a>
                    </div>
                    <div class="ui-grid-solo">
                        <a data-role="button" id="btnMagazzino" href="#pgSelezioneEntrate">Pratiche Attive</a>
                    </div>
                    <div class="ui-grid-solo">
                        <a data-role="button" href="#pgOreLavorate-main">Segna-Ore</a>
                    </div>
                    <div class="ui-grid-solo">
                        <a data-role="button" href="#pgRifornimenti">Rifornimenti</a>
                    </div>
                    <div class="ui-grid-solo">
                        <a data-role="button" href="#pgApprovvigionamenti">Ordinazioni</a>
                        <canvas id="myCanvas" height="100" width="100"></canvas>
                    </div>                    
                </div>
            </div>
        </div>
        <!-- Creazione pratica temporanea -->
        <div data-role="page" id="pgCreazionePratica" data-title="Ciclope - Creazione pratica temporanea">
            <div data-role="header" data-position="fixed">
                <h1>Ciclope - Creazione lista temporanea</h1>
                <a data-role="button" href="#pgMagazzino"
                   data-rel="page" data-icon="home">Home</a>
            </div>
            <div data-role="content">
                <form>
                    <label for="nome_cliente">Ragione Sociale/Cliente:</label>
                    <input type="text" name="nome_cliente" id="nome_cliente" placeholder="Nome per il cliente..." value="">
                    <label for="dati_veicolo">Dati veicolo:</label>
                    <input type="text" name="dati_veicolo" id="dati_veicolo" placeholder="Marca,modello,matricola veicolo o piattaforma..." value="">
                    <span style="display:inline-block">
                        <label for="kilometri_correnti">Kilometri correnti:</label>
                        <input type="number" name="kilometri_correnti" id="kilometri_correnti" placeholder="Kilometri del veicolo..." value="">
                    </span>
                    <label for="lavori_segnalati">LAVORI segnalati all'arrivo:</label>
                    <textarea cols="80" rows="8" name="lavori_segnalati" id="lavori_segnalati"></textarea>
                    <div style="margin:2em">
                        <input data-theme="b" type="button" onClick = "creaPraticaTemporanea()" value="Crea Pratica">
                    </div>
                </form>
            </div>
        </div>
        <div data-role="page" id="pgOreLavorate-main" data-title="Magazzino - Selezione Operatore">
            <div data-role="header" data-position="fixed">
                <h1>Selezione Operatore</h1>
                <a data-role="button" href="#pgMagazzino" data-rel="page"
                   data-icon="back">Indietro</a>
                <a data-role="button" class="ui-btn-right" onClick="reload()" data-icon="refresh">Aggiorna</a>
            </div>
            <div data-role="content">
                <p>Chi sei?</p>
                <ul class=" ui-content" data-role="listview" id="lstOperatori" data-inset="true">

                </ul>
            </div>
        </div>
        <div data-role="page" id="pgOreLavorate-selezione" data-title="Magazzino - Selezione Pratica">
            <div data-role="header" data-position="fixed">
                <h1>Seleziona Veicolo/Piattaforma</h1>
                <a data-role="button" data-rel="back"
                   data-icon="back">Indietro</a>
            </div>
            <div data-role="content">
                <div class="ui-grid-a ">
                    <div class="ui-block-a seleziona-ore">
                        <label for="giornata">Seleziona giornata:</label>
                        <input name="giornata"  id="giornata" type="text" data-role="datebox"
                               data-options='{"mode":"calbox", "useLang":"it", "closeCallback": "AggiornaOreLavorate" }' />
                    </div>
                    <div class="ui-block-b">  
                        <div id="ore_totali">
                            <h2>TOTALE ORE: <span style="font-weight: bold">0</span></h2>
                        </div>
                        <a data-role="button"  data-icon="plus" data-inline="true" data-iconpos="right"
                           href="#popupAggiungiPraticaOreLavorate" data-rel="popup" data-position-to="window" 
                           data-transition="pop">Aggiungi pratica lavorata</a>
                        <div data-role="popup" id="popupAggiungiPraticaOreLavorate" data-theme="a" data-overlay-theme="b" class="ui-content">
                            <div data-role="header" data-theme="a">
                                <h1>Aggiungi pratica tra quelle lavorate in questa giornata.</h1>
                            </div>
                            <div class="ui-content" role="main">
                                <h3 class="ui-title">Seleziona pratica:</h3>
                                <ul data-role="listview" id="lstPraticheLavorate" data-inset="true" data-filter="true"
                                    data-filter-placeholder="Seleziona la riparazione..." data-autodividers="true">
                                </ul>
                                <a class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" href="#" data-rel="back">Indietro</a>
                            </div>
                        </div>

                        <p>Lista delle pratiche seguite in questo giorno:</p>
                        <ul id="lstUltimePratiche" 
                            data-role="listview" data-split-icon="delete" 
                            data-split-theme="a" data-inset="true"
                            data-autodividers="true">
                        </ul>
                        <div data-role="popup" id="popupEliminaPraticaOreLavorate" data-theme="a" data-overlay-theme="b" class="ui-content">
                            <div data-role="header" data-theme="a">
                                <h1>Eliminazione ore su pratica.</h1>
                            </div>
                            <div class="ui-content" role="main">
                                <h3 class="ui-title">Eliminare le ore lavorate OGGI su questa pratica?</h3>
                                <a class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" href="#" data-rel="back">Annulla</a>
                                <a class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" href="#" data-transition="flow"
                                   onclick="CancellaOreLavoratePratica()" data-rel="back">Elimina!</a>
                            </div>
                        </div>
                        <div data-role="popup" id="popupAggiornaOreLavoratePratica" data-theme="a" data-overlay-theme="b" class="ui-content">
                            <div data-role="header" data-theme="a">
                                <h1>Aggiorna ore lavorate sulla pratica.</h1>
                            </div>
                            <div class="ui-content" role="main">
                                <h3 class="ui-title">Aggiornare le ore lavorate OGGI su questa pratica?</h3>
                                <input type="number" id="ore_da_aggiornare" name="ore_da_aggiornare" value="">
                                <a class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" href="#" data-rel="back">Annulla</a>
                                <a class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" href="#" data-transition="flow"
                                   onclick="AggiornaOreLavoratePratica()" data-rel="back">Aggiorna!</a>
                            </div>
                        </div> 
                    </div>
                </div>
            </div>
        </div>
        <!-- Selezione delle pratiche attive --> 
        <div data-role="page" id="pgSelezioneEntrate" data-title="Magazzino - Selezione Veicolo\Piattaforma">
            <div data-role="header" data-position="fixed">
                <h1>Seleziona Veicolo/Piattaforma</h1>
                <a data-role="button" href="#pgMagazzino" data-rel="page"
                   data-icon="back">Indietro</a>
                <a data-role="button" class="ui-btn-right" onClick="reload()" data-icon="refresh">Aggiorna</a>
            </div>
            <div data-role="content">
                <div>
                    <ul data-role="listview" id="lstRiparazioni" data-inset="true" data-filter="true"
                        data-filter-placeholder="Seleziona la riparazione..." data-autodividers="true">
                    </ul>
                </div>
            </div>
        </div>
        <!-- Materiale Utilizzato nelle pratiche -->
        <div data-role="page" id="pgMaterialeUtilizzato" data-title="Ciclope - materiale utilizzato per riparazioni.">
            <div data-role="header" data-position="fixed">
                <h1>Materiale Utilizzato per la Riparazione</h1>
                <a data-role="button" href="#pgMagazzino"
                   data-rel="page" data-icon="home">Home</a>
                <a data-role="button" href="#pgSelezioneEntrate" data-icon="back">Riparazioni</a>
            </div>
            <div data-role="content">
                <div id="nome_riparazione">
                    <h1>Riparazione aaa 2</h1>
                </div>
                <ol data-role="listview" id="lista_materiale" data-inset="true" data-filter="true"
                    data-filter-placeholder="Cerca materiale...">

                </ol>
            </div>
        </div>
        <!-- Approvvigionamenti -->
        <div data-role="page" id="pgApprovvigionamenti" data-title="Ciclope - Approvvigionamenti">
            <div data-role="header" data-position="fixed">
                <h1>Ciclope - Lista Approvvigionamenti</h1>
                <a data-role="button" href="#pgMagazzino"
                   data-rel="page" data-icon="home">Home</a>
                <a data-role="button" class="ui-btn-right" data-icon="refresh"  onClick="reload()" href="#pgApprovvigionamenti">Aggiorna</a>
            </div>
            <div data-role="content">
                <form class="ui-filterable">
                    <input id="filterApprovvigionamenti" data-type="search">
                </form>

                <ul data-role="listview" id="lista_approvvigionamenti" data-inset="true"
                    data-input="#filterApprovvigionamenti" data-filter="true" data-filter-placeholder="Cerca Materiale...">

                </ul>
            </div>
        </div>


        <!-- Rifornimenti -->
        <div data-role="page" id="pgRifornimenti" data-title="Ciclope - Rifornimenti">
            <div data-role="header" data-position="fixed">
                <h1>Ciclope - Lista Rifornimenti</h1>
                <a data-role="button" href="#pgMagazzino"
                   data-rel="page" data-icon="home">Home</a>
                <a data-role="button" class="ui-btn-right" data-icon="refresh"  onClick="reload()" href="#pgRifornimenti">Aggiorna</a>
            </div>
            <div data-role="content">
                <form class="ui-filterable">
                    <input id="filterRifornimenti" data-type="search">
                </form>

                <ul data-role="listview" id="lista_rifornimenti" data-inset="true"
                    data-input="#filterRifornimenti" data-filter="true" data-filter-placeholder="Cerca Materiale...">

                </ul>
            </div>
        </div>

        <!-- DIALOG Aggiornamento Rifornimento -->
        <div data-role="dialog" id="dlgAggiornaRifornimento" data-title="Ciclope - Aggiornamento quantità materiale">
            <div data-role="header" data-position="fixed">
                <h1 id="titleRifornimenti">Ciclope - Inserisci rifornimento materiale</h1>
                <a data-role="button" href="#pgRifornimenti" data-rel="back" data-icon="back">Annulla</a>
            </div>
            <div data-role="content">
                <form>
                    <label for="quantita_da_rifornire" id="title_rifornimento_corrente">Rifornimento attuale: </label>
                    <input type="hidden" name="codiceMaterialeRif" id="codiceMaterialeRif" value="">
                    <input type="hidden" name="rifornimento_corrente" id="rifornimento_corrente" value="">
                    <input type="number" id="quantita_da_rifornire" name="quantita_da_rifornire" value="">
                    <input type="button" onClick="AggiornaRifornimentoDlg()" value="Aggiungi" data-icon="check">
                </form>
            </div>
        </div>
        <!-- DIALOG Aggiornamento Approvvigionamenti -->
        <div data-role="dialog" id="dlgAggiornaApprovvigionamento" data-title="Ciclope - Aggiornamento quantità materiale">
            <div data-role="header" data-position="fixed">
                <h1 id="titleApprovvigionamenti">Ciclope - Inserisci approvvigionamento materiale</h1>
                <a data-role="button" href="#pgApprovvigionamenti" data-rel="back" data-icon="back">Annulla</a>
            </div>
            <div data-role="content">
                <form>
                    <label for="quantita_da_approvvigionare" id="title_approvvigionamento_corrente">Approvvigionamento attuale: </label>
                    <input type="hidden" name="codiceMateriale" id="codiceMateriale" value="">
                    <input type="hidden" name="approvvigionamento_corrente" id="approvvigionamento_corrente" value="">
                    <input type="number" id="quantita_da_approvvigionare" name="quantita_da_approvvigionare" value="">
                    <input type="button" onClick="AggiornaApprovvigionamentoDlg()" value="Aggiorna" data-icon="check">
                </form>
            </div>
        </div>
        <!-- DIALOG Aggiornamento quantita -->
        <div data-role="dialog" id="dlgAggiornaQuantita" data-title="Ciclope - Aggiornamento quantità materiale">
            <div data-role="header" data-position="fixed">
                <h1 id="titleAggiornamento">Ciclope - Aggiornamento quantità materiale</h1>
                <a data-role="button" href="#pgMagazzino" data-rel="back" data-icon="back">Annulla</a>
            </div>
            <div data-role="content">
                <form>
                    <label for="quantita_da_aggiornare" id="title_qty_corrente">Quantita utilizzata: </label>
                    <input type="hidden" name="praticaId" id="praticaId" value="">
                    <input type="hidden" name="materialeId" id="materialeId" value="">
                    <input type="hidden" name="quantita_corrente" id="quantita_corrente" value="">
                    <input type="number" id="quantita_da_aggiornare" name="quantita_da_aggiornare" value="">
                    <input type="button" onClick="AggiornaQuantitaMaterialeDlg()" value="Aggiorna" data-icon="check">
                </form>
            </div>
        </div>

        <div data-role="page" data-dialog="true" id="pgError">
            <div data-role="header">
                <h1>Errore caricamento dati</h1>
            </div>

            <div data-role="main" class="ui-content">
                <p>I dati non possono essere caricati al momento...</p>
                <ol>
                    <li>Il server è acceso?</li>
                    <li>I cavi di rete sono tutti attaccati?</li>
                    <li>Il servizio è attivo?</li>
                    <li style="font: italic bold 12px/30px Georgia, serif"> CHIAMATE ANDREA 329 0846309 :) (borda!)</li>
                </ol>
                <p>Quando il problema è risolto premi<a href="#pgMagazzino">qua.</a></p>
            </div>

            <div data-role="footer">
                <h1>Footer Text In Dialog</h1>
            </div>
        </div> 
    </body>

</html>